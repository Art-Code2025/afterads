# دليل تكوين العملة 💰

هذا الدليل يوضح كيفية تغيير العملة في نظام الدفع من الجنيه المصري إلى الريال السعودي أو أي عملة أخرى.

## ⚠️ ملاحظة مهمة

**حالياً، حساب Paymob المستخدم في هذا المشروع يدعم الجنيه المصري (EGP) فقط.** <mcreference link="https://www.paymob.com/en/" index="4">4</mcreference> <mcreference link="https://techcrunch.com/2021/04/08/egypts-paymob-closes-18-5m-series-a-to-expand-payments-services-across-mena/" index="5">5</mcreference>

لاستخدام الريال السعودي (SAR) أو عملات أخرى، ستحتاج إلى:
1. **حساب Paymob يدعم العملة المطلوبة**
2. **Integration ID مخصص للعملة الجديدة**
3. **تفعيل العملة في لوحة تحكم Paymob**

## 🔧 الخطوات المطلوبة

### 1. تحديث متغيرات البيئة

في ملف `.env`، أضف أو حدث المتغير التالي:

```env
# إعدادات العملة
# ملاحظة: تأكد من أن حساب Paymob يدعم العملة المختارة
PAYMENT_CURRENCY=EGP  # أو SAR عند توفر الدعم
```

**العملات المدعومة:**
- `SAR` - الريال السعودي
- `EGP` - الجنيه المصري
- `USD` - الدولار الأمريكي
- `EUR` - اليورو
- `AED` - الدرهم الإماراتي
- `KWD` - الدينار الكويتي
- `QAR` - الريال القطري
- `BHD` - الدينار البحريني
- `OMR` - الريال العماني
- `JOD` - الدينار الأردني

### 2. التحقق من دعم العملة في Paymob

**خطوات مهمة قبل تغيير العملة:**

1. **تحقق من دعم العملة:**
   - سجل دخول إلى [لوحة تحكم Paymob](https://accept.paymob.com/portal2/en/PaymobDeveloperPortal)
   - اذهب إلى **Settings** → **Currencies**
   - تحقق من العملات المدعومة في حسابك

2. **للحصول على دعم الريال السعودي:**
   - اتصل بفريق دعم Paymob على: **19079**
   - اطلب تفعيل دعم العملة السعودية (SAR)
   - قد تحتاج إلى تقديم مستندات إضافية

3. **البدائل المتاحة:**
   - استخدام بوابة دفع أخرى تدعم SAR مثل HyperPay أو Moyasar
   - الاحتفاظ بـ EGP وتحويل الأسعار يدوياً
   - انتظار توسع Paymob في السعودية (مخطط لعام 2021 حسب التقارير) <mcreference link="https://techcrunch.com/2021/04/08/egypts-paymob-closes-18-5m-series-a-to-expand-payments-services-across-mena/" index="5">5</mcreference>

### 3. تحديث Integration ID

قد تحتاج إلى إنشاء Integration جديد للعملة الجديدة:

1. في لوحة تحكم Paymob، اذهب إلى **Integrations**
2. أنشئ Integration جديد للعملة المطلوبة
3. حدث `PAYMOB_INTEGRATION_ID` في ملف `.env`

### 4. تحديث بيانات الفوترة (اختياري)

إذا كنت تغير من مصر إلى السعودية، فقد تم تحديث البيانات التالية تلقائياً:

- **رقم الهاتف الافتراضي:** `+966500000000`
- **الرمز البريدي:** `11564` (الرياض)
- **المدينة:** `Riyadh`
- **الدولة:** `SA`
- **المنطقة:** `Riyadh`

## 🧪 اختبار التغييرات

### 1. إعادة تشغيل الخادم

```bash
# أوقف الخادم الحالي (Ctrl+C)
# ثم أعد تشغيله
npm run dev
# أو
netlify dev
```

### 2. اختبار عملية الدفع

1. اذهب إلى صفحة الدفع
2. أدخل بيانات اختبار
3. تأكد من ظهور العملة الجديدة في:
   - صفحة الدفع
   - رسائل التأكيد
   - فواتير Paymob

## 📋 قائمة التحقق

- [ ] تحديث `PAYMENT_CURRENCY` في ملف `.env`
- [ ] التأكد من دعم Paymob للعملة الجديدة
- [ ] تحديث Integration ID إذا لزم الأمر
- [ ] اختبار عملية الدفع الكاملة
- [ ] التأكد من صحة عرض العملة في الواجهة
- [ ] اختبار رسائل التأكيد والفواتير

## ⚠️ ملاحظات مهمة

1. **دعم العملة:** تأكد من دعم بوابة الدفع للعملة قبل التغيير. حالياً Paymob يدعم EGP بشكل أساسي.

2. **أسعار الصرف:** النظام لا يقوم بتحويل العملات تلقائياً. تأكد من تحديث الأسعار يدوياً.

3. **بيانات اختبار:** استخدم بيانات اختبار مناسبة للعملة الجديدة.

4. **الإنتاج:** اختبر التغييرات في بيئة التطوير قبل النشر.

5. **النسخ الاحتياطي:** احتفظ بنسخة احتياطية من الإعدادات القديمة.

6. **البدائل:** إذا كنت تحتاج SAR فوراً، فكر في بوابات دفع أخرى مثل:
   - **HyperPay** (يدعم SAR)
   - **Moyasar** (سعودي)
   - **PayTabs** (يدعم المنطقة)
   - **Checkout.com** (عالمي)

## 🆘 استكشاف الأخطاء

### خطأ "Invalid currency sent" أو "Currency not supported"
- **السبب الأكثر شيوعاً:** حساب Paymob لا يدعم العملة المطلوبة
- **الحل:** اتصل بدعم Paymob لتفعيل العملة أو استخدم بوابة دفع أخرى
- تحقق من صحة رمز العملة (3 أحرف: EGP, SAR, USD, إلخ)

### خطأ "Integration not found"
- تأكد من استخدام Integration ID صحيح للعملة الجديدة
- أنشئ Integration جديد إذا لزم الأمر

### مشاكل في عرض العملة
- تأكد من إعادة تشغيل الخادم بعد تحديث متغيرات البيئة
- امسح cache المتصفح

---

**تم تحديث العملة بنجاح! 🎉**

للمساعدة الإضافية، راجع [دليل إعداد Paymob](./PAYMOB_SETUP.md)